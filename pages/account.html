<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CryptoVest Dashboard</title>
  <link rel="stylesheet" href="../assets/css/style.css">
  <!-- EmailJS Library for Real Email Sending -->
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/index.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // Authentication check - redirect if not logged in
    document.addEventListener('DOMContentLoaded', function() {
      const currentUser = localStorage.getItem('currentUser');
      if (!currentUser) {
        window.location.href = 'login.html';
        return;
      }
    });
  </script>
</head>
<body>
  <div class="watermark"><img src="../assets/images/logo.png" alt="" /></div>
  <header>
    <div class="logo"><img src="../assets/images/logo.png" alt="CryptoVest Logo" style="height: 40px; margin-right: 10px; vertical-align: middle;">CryptoVest</div>
    <nav>
      <a href="index.html">Home</a>
      <a href="account.html">Dashboard</a>
      <a href="email-history.html">üìß Emails</a>
      <a href="customer-service.html" class="support-link">üí¨ Support</a>
      <button id="logoutBtn" class="btn-small">Logout</button>
    </nav>
  </header>

  <section class="dashboard">
    <!-- Welcome Header -->
    <div class="welcome-header">
      <div class="welcome-text">
        <h1>Welcome, <span id="userName">Investor</span>! üëã</h1>
        <p>Here's your investment overview</p>
      </div>
      <div class="account-status">
        <span class="status-badge verified">‚úì Verified Account</span>
      </div>
    </div>

    <!-- Portfolio Summary Cards -->
    <div class="portfolio-summary">
      <div class="summary-card total-balance">
        <div class="card-icon">üí∞</div>
        <div class="card-content">
          <p class="card-label">Total Balance</p>
          <h3 id="totalBalance" class="card-value">$0.00</h3>
        </div>
      </div>
      <div class="summary-card profit-loss">
        <div class="card-icon">üìà</div>
        <div class="card-content">
          <p class="card-label">Total Gain/Loss</p>
          <h3 id="profitLoss" class="card-value positive">+$0.00</h3>
        </div>
      </div>
      <div class="summary-card invested">
        <div class="card-icon">üíé</div>
        <div class="card-content">
          <p class="card-label">Total Invested</p>
          <h3 id="totalInvested" class="card-value">$0.00</h3>
        </div>
      </div>
      <div class="summary-card roi">
        <div class="card-icon">üìä</div>
        <div class="card-content">
          <p class="card-label">ROI</p>
          <h3 id="roi" class="card-value">0%</h3>
        </div>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
      <button id="depositBtn" class="action-btn deposit">
        <span class="icon">‚¨áÔ∏è</span>
        <span>Deposit</span>
      </button>
      <button id="withdrawBtn" class="action-btn withdraw">
        <span class="icon">‚¨ÜÔ∏è</span>
        <span>Withdraw</span>
      </button>
      <button id="buyBtn" class="action-btn buy">
        <span class="icon">üîÑ</span>
        <span>Buy Crypto</span>
      </button>
      <button id="settingsBtn" class="action-btn settings" onclick="openSettings('profile')">
        <span class="icon">‚öôÔ∏è</span>
        <span>Settings</span>
      </button>
    </div>

    <!-- Main Content Grid -->
    <div class="dashboard-grid">
      <!-- Portfolio Chart -->
      <div class="chart-container">
        <h2>Portfolio Performance (30 Days)</h2>
        <canvas id="portfolioChart"></canvas>
      </div>

      <!-- Cryptocurrency Holdings -->
      <div class="holdings-container">
        <h2>Your Holdings</h2>
        <div class="holdings-list" id="holdingsList">
          <div class="holding-item">
            <div class="holding-header">
              <span class="crypto-icon">‚Çø</span>
              <div class="crypto-info">
                <h4>Bitcoin (BTC)</h4>
                <span class="holding-amount">0.0000 BTC</span>
              </div>
            </div>
            <div class="holding-value">
              <span class="value">$0.00</span>
              <span class="change positive">+0%</span>
            </div>
          </div>
          <div class="holding-item">
            <div class="holding-header">
              <span class="crypto-icon eth">Œû</span>
              <div class="crypto-info">
                <h4>Ethereum (ETH)</h4>
                <span class="holding-amount">0.0000 ETH</span>
              </div>
            </div>
            <div class="holding-value">
              <span class="value">$0.00</span>
              <span class="change">+0%</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Investment Statistics -->
    <div class="stats-grid">
      <div class="stat-card">
        <h3>Account Age</h3>
        <p id="accountAge" class="stat-value">0 days</p>
      </div>
      <div class="stat-card">
        <h3>Total Transactions</h3>
        <p id="totalTransactions" class="stat-value">0</p>
      </div>
      <div class="stat-card">
        <h3>Success Rate</h3>
        <p id="successRate" class="stat-value">100%</p>
      </div>
      <div class="stat-card">
        <h3>Best Performer</h3>
        <p id="bestPerformer" class="stat-value">N/A</p>
      </div>
    </div>

    <!-- Recent Transactions -->
    <div class="transactions-container">
      <h2>Recent Transactions</h2>
      <div class="transactions-list">
        <div class="transaction-header">
          <span>Type</span>
          <span>Amount</span>
          <span>Asset</span>
          <span>Date</span>
          <span>Status</span>
        </div>
        <div id="transactionList" class="transactions-body">
          <div class="no-transactions">
            <p>üì≠ No transactions yet. Start investing to see your transaction history here.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Security & Account Info -->
    <div class="account-info">
      <h2>Account Security</h2>
      <div class="security-items">
        <div class="security-item">
          <span class="security-icon">üîê</span>
          <div class="security-details">
            <h4>Two-Factor Authentication</h4>
            <p id="twoFAStatus">Not Enabled</p>
          </div>
          <button id="enable2FABtn" class="btn-small" onclick="enableTwoFactor()">Enable</button>
        </div>
        <div class="security-item">
          <span class="security-icon">üîë</span>
          <div class="security-details">
            <h4>Password</h4>
            <p>Last changed 30 days ago</p>
          </div>
          <button class="btn-small" onclick="openSettings('security')">Update</button>
        </div>
        <div class="security-item">
          <span class="security-icon">üìß</span>
          <div class="security-details">
            <h4>Email Address</h4>
            <p id="emailDisplay">user@example.com</p>
          </div>
          <button class="btn-small" onclick="openSettings('security')">Verify</button>
        </div>
      </div>
    </div>

    <!-- Settings modal moved to end of body to avoid stacking-context issues -->
  </section>

  <footer style="background: #000; border-top: 2px solid #FFD700; padding: 30px; text-align: center; color: #999; margin-top: 50px;">
    <div style="max-width: 1200px; margin: 0 auto;">
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px; margin-bottom: 20px;">
        <div>
          <h4 style="color: #FFD700; margin: 0 0 10px 0;">Account</h4>
          <p style="margin: 5px 0;"><a href="account.html" style="color: #999; text-decoration: none;">Dashboard</a></p>
          <p style="margin: 5px 0;"><a href="customer-service.html" style="color: #999; text-decoration: none;">Support</a></p>
        </div>
        <div>
          <h4 style="color: #FFD700; margin: 0 0 10px 0;">Legal</h4>
          <p style="margin: 5px 0;"><a href="privacy-policy.html" style="color: #999; text-decoration: none;">Privacy</a></p>
          <p style="margin: 5px 0;"><a href="terms-of-service.html" style="color: #999; text-decoration: none;">Terms</a></p>
        </div>
        <div>
          <h4 style="color: #FFD700; margin: 0 0 10px 0;">More</h4>
          <p style="margin: 5px 0;"><a href="index.html" style="color: #999; text-decoration: none;">Home</a></p>
          <p style="margin: 5px 0;"><a href="login.html" style="color: #999; text-decoration: none;">Sign Out</a></p>
        </div>
      </div>
      <hr style="border: 1px solid #333; margin: 20px 0;">
      <p style="margin: 0;">¬© 2026 CryptoVest. All rights reserved. | Secure ‚Ä¢ Transparent ‚Ä¢ Profitable</p>
    </div>
  </footer>

    <!-- Settings Modal (moved here to avoid stacking context conflicts) -->
    <div id="settingsModal" class="modal">
      <div class="modal-content">
        <button class="modal-close" onclick="closeSettings()">&times;</button>

        <!-- Settings Tabs -->
        <div class="settings-tabs">
          <button class="tab-button active" data-tab="profile">üë§ Profile</button>
          <button class="tab-button" data-tab="security">üîí Security</button>
          <button class="tab-button" data-tab="notifications">üîî Notifications</button>
          <button class="tab-button" data-tab="payment">üí≥ Payment Methods</button>
          <button class="tab-button" data-tab="privacy">üîê Privacy</button>
        </div>

        <!-- Profile Tab -->
        <div id="profile" class="tab-content active">
          <h3>Profile Settings</h3>
          <form id="profileForm">
            <div class="form-group">
              <label for="firstName">First Name</label>
              <input type="text" id="firstName" placeholder="Your first name">
            </div>
            <div class="form-group">
              <label for="lastName">Last Name</label>
              <input type="text" id="lastName" placeholder="Your last name">
            </div>
            <div class="form-group">
              <label for="phone">Phone Number</label>
              <input type="tel" id="phone" class="phone-input" inputmode="tel" pattern="[+0-9 ()-]*" maxlength="20" placeholder="+1 (555) 123-4567">
            </div>
            <div class="form-group">
              <label for="bio">Bio</label>
              <textarea id="bio" placeholder="Tell us about yourself" rows="4"></textarea>
            </div>
            <button type="submit" class="btn-small">Save Changes</button>
          </form>
        </div>

        <!-- Security Tab -->
        <div id="security" class="tab-content">
          <h3>Security Settings</h3>

          <div class="settings-section">
            <h4>Change Password</h4>
            <form id="passwordForm">
              <div class="form-group">
                <label for="currentPassword">Current Password</label>
                <input type="password" id="currentPassword" placeholder="Enter current password">
              </div>
              <div class="form-group">
                <label for="newPassword">New Password</label>
                <input type="password" id="newPassword" placeholder="Enter new password">
              </div>
              <div class="form-group">
                <label for="confirmPassword">Confirm Password</label>
                <input type="password" id="confirmPassword" placeholder="Confirm new password">
              </div>
              <button type="submit" class="btn-small">Update Password</button>
            </form>
          </div>

          <div class="settings-section">
            <h4>Two-Factor Authentication (2FA)</h4>
            <p>Add an extra layer of security to your account</p>
            <div class="toggle-switch">
              <input type="checkbox" id="twoFactorToggle">
              <label for="twoFactorToggle">Enable 2FA</label>
            </div>
          </div>

          <div class="settings-section">
            <h4>Login History</h4>
            <div class="login-history">
              <div class="history-item">
                <span>üñ•Ô∏è Desktop - Chrome</span>
                <span>Last active: Today at 2:30 PM</span>
                <button class="btn-small-danger">Logout</button>
              </div>
              <div class="history-item">
                <span>üì± Mobile - Safari</span>
                <span>Last active: Yesterday at 5:15 PM</span>
                <button class="btn-small-danger">Logout</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Notifications Tab -->
        <div id="notifications" class="tab-content">
          <h3>Notification Preferences</h3>

          <div class="settings-section">
            <div class="notification-option">
              <div>
                <h4>Price Alerts</h4>
                <p>Get notified when crypto prices reach your targets</p>
              </div>
              <div class="toggle-switch">
                <input type="checkbox" id="priceAlerts" checked>
                <label for="priceAlerts"></label>
              </div>
            </div>

            <div class="notification-option">
              <div>
                <h4>Transaction Confirmations</h4>
                <p>Receive notifications for all deposits and withdrawals</p>
              </div>
              <div class="toggle-switch">
                <input type="checkbox" id="transactionAlerts" checked>
                <label for="transactionAlerts"></label>
              </div>
            </div>

            <div class="notification-option">
              <div>
                <h4>Portfolio Updates</h4>
                <p>Daily summary of your portfolio performance</p>
              </div>
              <div class="toggle-switch">
                <input type="checkbox" id="portfolioAlerts">
                <label for="portfolioAlerts"></label>
              </div>
            </div>

            <div class="notification-option">
              <div>
                <h4>Marketing Emails</h4>
                <p>Latest news, tips, and offers from CryptoVest</p>
              </div>
              <div class="toggle-switch">
                <input type="checkbox" id="marketingEmails"></input>
                <label for="marketingEmails"></label>
              </div>
            </div>
          </div>

          <div class="settings-section">
            <h4>Notification Channels</h4>
            <div class="notification-option">
              <label>
                <input type="checkbox" checked> Email Notifications
              </label>
            </div>
            <div class="notification-option">
              <label>
                <input type="checkbox"> SMS Notifications
              </label>
            </div>
            <div class="notification-option">
              <label>
                <input type="checkbox"> Push Notifications
              </label>
            </div>
          </div>
        </div>

        <!-- Payment Methods Tab -->
        <div id="payment" class="tab-content">
          <h3>Payment Methods</h3>

          <div class="payment-methods">
            <div class="payment-card">
              <div class="card-details">
                <span class="card-icon">üí≥</span>
                <div>
                  <h4>Visa Card</h4>
                  <p>****  ****  ****  4242</p>
                </div>
              </div>
              <div class="card-actions">
                <span class="badge">Primary</span>
                <button class="btn-small-danger">Remove</button>
              </div>
            </div>

            <div class="payment-card">
              <div class="card-details">
                <span class="card-icon">üè¶</span>
                <div>
                  <h4>Bank Account</h4>
                  <p>Account ending in 5678</p>
                </div>
              </div>
              <div class="card-actions">
                <button class="btn-small">Set as Primary</button>
                <button class="btn-small-danger">Remove</button>
              </div>
            </div>
          </div>

          <div class="settings-section">
            <h4>Add New Payment Method</h4>
            <form id="paymentForm">
              <div class="form-group">
                <label for="cardName">Cardholder Name</label>
                <input type="text" id="cardName" placeholder="John Doe">
              </div>
              <div class="form-group">
                <label for="cardNumber">Card Number</label>
                <input type="text" id="cardNumber" placeholder="1234 5678 9012 3456">
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="expiryDate">Expiry Date</label>
                  <input type="text" id="expiryDate" placeholder="MM/YY">
                </div>
                <div class="form-group">
                  <label for="cvv">CVV</label>
                  <input type="text" id="cvv" placeholder="***"></input>
                </div>
              </div>
              <button type="submit" class="btn-small">Add Card</button>
            </form>
          </div>
        </div>

        <!-- Privacy Tab -->
        <div id="privacy" class="tab-content">
          <h3>Privacy Settings</h3>

          <div class="settings-section">
            <div class="notification-option">
              <div>
                <h4>Profile Visibility</h4>
                <p>Allow other users to view your profile</p>
              </div>
              <div class="toggle-switch">
                <input type="checkbox" id="profileVisibility" checked>
                <label for="profileVisibility"></label>
              </div>
            </div>

            <div class="notification-option">
              <div>
                <h4>Display Portfolio Value</h4>
                <p>Show your total balance on your profile</p>
              </div>
              <div class="toggle-switch">
                <input type="checkbox" id="displayPortfolio">
                <label for="displayPortfolio"></label>
              </div>
            </div>

            <div class="notification-option">
              <div>
                <h4>Allow Direct Messages</h4>
                <p>Let other verified users contact you</p>
              </div>
              <div class="toggle-switch">
                <input type="checkbox" id="allowMessages">
                <label for="allowMessages"></label>
              </div>
            </div>
          </div>

          <div class="settings-section">
            <h4>Data & Privacy</h4>
            <button class="btn-small-danger" onclick="downloadData()">Download My Data</button>
            <button class="btn-small-danger" onclick="deleteAccount()">Delete Account</button>
          </div>
        </div>
      </div>
    </div>

    <script src="../assets/js/script.js"></script>
  <script>
    // Dashboard initialization and sample data
    document.addEventListener('DOMContentLoaded', function() {
      const userData = JSON.parse(localStorage.getItem('currentUser')) || {};
      document.getElementById('userName').textContent = (userData.firstName || userData.name) || 'Investor';
      document.getElementById('emailDisplay').textContent = userData.email || 'user@example.com';

      // Get deposits from localStorage (only confirmed deposits count towards balance)
      const deposits = JSON.parse(localStorage.getItem('deposits')) || [];
      let depositTotal = 0;
      deposits.forEach(deposit => {
        if (deposit.status === 'confirmed') {
          depositTotal += parseFloat(deposit.amount || 0);
        }
      });
      
      // Sample portfolio data (updated with deposit amounts)
      const portfolioData = {
        balance: 0,
        invested: 0,
        gain: 0,
        roi: 0,
        accountAge: 0,
        transactions: 0,
        holdings: {
          btc: 0,
          eth: 0
        }
      };

      // Update summary cards
      document.getElementById('totalBalance').textContent = '$' + portfolioData.balance.toFixed(2);
      document.getElementById('profitLoss').textContent = '+$' + portfolioData.gain.toFixed(2);
      document.getElementById('totalInvested').textContent = '$' + portfolioData.invested.toFixed(2);
      document.getElementById('roi').textContent = portfolioData.roi.toFixed(2) + '%';
      document.getElementById('accountAge').textContent = portfolioData.accountAge + ' days';
      document.getElementById('totalTransactions').textContent = portfolioData.transactions;

      // Update holdings
      const holdingsList = document.getElementById('holdingsList');
      if (portfolioData.holdings.btc > 0 || portfolioData.holdings.eth > 0) {
        let holdings = '';
        if (portfolioData.holdings.btc > 0) {
          holdings += `<div class="holding-item">
            <div class="holding-header">
              <span class="crypto-icon">‚Çø</span>
              <div class="crypto-info">
                <h4>Bitcoin (BTC)</h4>
                <span class="holding-amount">${portfolioData.holdings.btc.toFixed(4)} BTC</span>
              </div>
            </div>
            <div class="holding-value">
              <span class="value">$${(portfolioData.holdings.btc * 45000).toFixed(2)}</span>
              <span class="change positive">+4.2%</span>
            </div>
          </div>`;
        }
        if (portfolioData.holdings.eth > 0) {
          holdings += `<div class="holding-item">
            <div class="holding-header">
              <span class="crypto-icon eth">Œû</span>
              <div class="crypto-info">
                <h4>Ethereum (ETH)</h4>
                <span class="holding-amount">${portfolioData.holdings.eth.toFixed(4)} ETH</span>
              </div>
            </div>
            <div class="holding-value">
              <span class="value">$${(portfolioData.holdings.eth * 2500).toFixed(2)}</span>
              <span class="change positive">+2.8%</span>
            </div>
          </div>`;
        }
        holdingsList.innerHTML = holdings;
      }

      // Initialize portfolio chart
      initPortfolioChart();

      // Transaction handlers
      document.getElementById('depositBtn').addEventListener('click', () => {
        window.location.href = 'deposit.html';
      });
      document.getElementById('withdrawBtn').addEventListener('click', () => {
        window.location.href = 'withdraw.html';
      });
      document.getElementById('buyBtn').addEventListener('click', () => {
        alert('Buy Crypto - Open trading interface');
      });
      document.getElementById('settingsBtn').addEventListener('click', () => {
        openSettings('profile');
      });
      document.getElementById('logoutBtn').addEventListener('click', () => {
        localStorage.removeItem('currentUser');
        window.location.href = 'login.html';
      });

      // Settings functionality
      setupSettingsModal();
    });

    // Settings Modal Functions
    function setupSettingsModal() {
      // Pre-fill user data
      const currentUser = JSON.parse(localStorage.getItem('currentUser')) || {};
      if (currentUser.firstName) document.getElementById('firstName').value = currentUser.firstName;
      if (currentUser.lastName) document.getElementById('lastName').value = currentUser.lastName;
      if (currentUser.phone) document.getElementById('phone').value = currentUser.phone;
      if (currentUser.bio) document.getElementById('bio').value = currentUser.bio;

      const tabButtons = document.querySelectorAll('.tab-button');
      const tabContents = document.querySelectorAll('.tab-content');

      tabButtons.forEach(button => {
        button.addEventListener('click', function() {
          const tabName = this.getAttribute('data-tab');
          
          // Remove active from all
          tabButtons.forEach(btn => btn.classList.remove('active'));
          tabContents.forEach(content => content.classList.remove('active'));
          
          // Add active to clicked
          this.classList.add('active');
          const activeTab = document.getElementById(tabName);
          if (activeTab) {
            activeTab.classList.add('active');
          }
        });
      });

      // Form handlers
      const profileForm = document.getElementById('profileForm');
      if (profileForm) {
        profileForm.addEventListener('submit', function(e) {
          e.preventDefault();
          const updatedUser = JSON.parse(localStorage.getItem('currentUser')) || {};
          updatedUser.firstName = document.getElementById('firstName').value;
          updatedUser.lastName = document.getElementById('lastName').value;
          updatedUser.phone = document.getElementById('phone').value;
          updatedUser.bio = document.getElementById('bio').value;
          localStorage.setItem('currentUser', JSON.stringify(updatedUser));
          alert('Profile updated successfully!');
          closeSettings();
        });
      }

      const passwordForm = document.getElementById('passwordForm');
      if (passwordForm) {
        passwordForm.addEventListener('submit', function(e) {
          e.preventDefault();
          const newPassword = document.getElementById('newPassword').value;
          const confirmPassword = document.getElementById('confirmPassword').value;

          if (newPassword !== confirmPassword) {
            alert('Passwords do not match');
            return;
          }

          if (newPassword.length < 8) {
            alert('Password must be at least 8 characters');
            return;
          }

          const updatedUser = JSON.parse(localStorage.getItem('currentUser')) || {};
          updatedUser.password = newPassword;
          localStorage.setItem('currentUser', JSON.stringify(updatedUser));
          alert('Password changed successfully!');
          this.reset();
          closeSettings();
        });
      }

      const paymentForm = document.getElementById('paymentForm');
      if (paymentForm) {
        paymentForm.addEventListener('submit', function(e) {
          e.preventDefault();
          alert('Payment method added successfully!');
          this.reset();
          closeSettings();
        });
      }

      // Toggle switches
      const twoFactorToggle = document.getElementById('twoFactorToggle');
      if (twoFactorToggle) {
        // initialize from stored user
        twoFactorToggle.checked = !!currentUser.twoFactor;
        const twoFAStatusEl = document.getElementById('twoFAStatus');
        if (twoFAStatusEl) twoFAStatusEl.textContent = twoFactorToggle.checked ? 'Enabled' : 'Not Enabled';

        twoFactorToggle.addEventListener('change', function() {
          const status = this.checked ? 'Enabled' : 'Disabled';
          // Persist to storage
          const updatedUser = JSON.parse(localStorage.getItem('currentUser')) || {};
          updatedUser.twoFactor = this.checked;
          localStorage.setItem('currentUser', JSON.stringify(updatedUser));
          // Update UI
          if (twoFAStatusEl) twoFAStatusEl.textContent = this.checked ? 'Enabled' : 'Not Enabled';
          showToast('Two-Factor Authentication ' + status, this.checked ? 'success' : 'info');

          // Send security email when 2FA is enabled (or disabled)
          if (this.checked && updatedUser.email && typeof emailService !== 'undefined') {
            emailService.sendSecurityAlertEmail(updatedUser.email, 'Two-Factor Authentication Enabled', '2FA was enabled for your account via Settings').catch(()=>{});
          } else if (!this.checked && updatedUser.email && typeof emailService !== 'undefined') {
            emailService.sendSecurityAlertEmail(updatedUser.email, 'Two-Factor Authentication Disabled', '2FA was disabled for your account via Settings').catch(()=>{});
          }
        });
      }

      // Notification toggles
      const notificationToggles = ['priceAlerts', 'transactionAlerts', 'portfolioAlerts', 'marketingEmails'];
      notificationToggles.forEach(id => {
        const element = document.getElementById(id);
        if (element) {
          element.addEventListener('change', function() {
            alert('Notification preference updated');
          });
        }
      });
    }

    function openSettings(tab) {
      const modal = document.getElementById('settingsModal');
      modal.style.display = 'block';
      
      if (tab) {
        const tabButton = document.querySelector(`[data-tab="${tab}"]`);
        if (tabButton) {
          tabButton.click();
        }
      }
    }

    function closeSettings() {
      const modal = document.getElementById('settingsModal');
      modal.style.display = 'none';
    }

    // Enable 2FA directly from dashboard button
    function enableTwoFactor() {
      const twoFactorToggle = document.getElementById('twoFactorToggle');
      const twoFAStatusEl = document.getElementById('twoFAStatus');
      const updatedUser = JSON.parse(localStorage.getItem('currentUser')) || {};

      // If toggle exists, check it; otherwise just set storage
      if (twoFactorToggle) {
        twoFactorToggle.checked = true;
      }
      updatedUser.twoFactor = true;
      localStorage.setItem('currentUser', JSON.stringify(updatedUser));
      if (twoFAStatusEl) twoFAStatusEl.textContent = 'Enabled';
      showToast('Two-Factor Authentication Enabled', 'success');
      if (updatedUser.email && typeof emailService !== 'undefined') {
        emailService.sendSecurityAlertEmail(updatedUser.email, 'Two-Factor Authentication Enabled', '2FA was enabled for your account via Dashboard').catch(()=>{});
      }
    }

    function downloadData() {
      const userData = JSON.parse(localStorage.getItem('currentUser'));
      const dataStr = JSON.stringify(userData, null, 2);
      const dataBlob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(dataBlob);
      const link = document.createElement('a');
      link.href = url;
      link.download = 'cryptovest_account_data.json';
      link.click();
    }

    function deleteAccount() {
      const confirmed = confirm('Are you sure you want to delete your account? This action cannot be undone!');
      if (confirmed) {
        localStorage.removeItem('currentUser');
        alert('Account deleted successfully. You will be redirected to the home page.');
        window.location.href = 'index.html';
      }
    }

    // Close modal when clicking outside
    window.addEventListener('click', function(event) {
      const modal = document.getElementById('settingsModal');
      if (event.target === modal) {
        closeSettings();
      }
    });

    function initPortfolioChart() {
      const ctx = document.getElementById('portfolioChart').getContext('2d');
      new Chart(ctx, {
        type: 'line',
        data: {
          labels: ['Day 1', 'Day 5', 'Day 10', 'Day 15', 'Day 20', 'Day 25', 'Day 30'],
          datasets: [{
            label: 'Portfolio Value ($)',
            data: [5000, 5050, 5100, 5080, 5150, 5200, 5250.75],
            borderColor: '#FFD700',
            backgroundColor: 'rgba(255, 215, 0, 0.1)',
            borderWidth: 3,
            fill: true,
            tension: 0.4,
            pointRadius: 5,
            pointBackgroundColor: '#FFD700',
            pointBorderColor: '#000',
            pointBorderWidth: 2
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              labels: {
                color: '#FFD700',
                font: { size: 12 }
              }
            }
          },
          scales: {
            y: {
              grid: { color: '#333' },
              ticks: { color: '#FFD700' },
              min: 4900
            },
            x: {
              grid: { color: '#333' },
              ticks: { color: '#FFD700' }
            }
          }
        }
      });
    }
  </script>
</body>
</html>
